language: go
go:
  - "1.11"

env:
  global:
    - secure: "KfoaYYuPG1APVJXyxJdRPeVkHugPUPYld4xl4RssiaJB8mmsq3B6iDnusUcGI3b4h3gAMzQyBjnperIZuVeTk23EAOReJN3AuOiIZbAksgh6YHxWdZw54waPkvB/FDNnq5SKJeYO6YRayu2LqxYXHximLjMui5PybBjwVoJ1bx9rqz115R0BZFmWIwcBwuvaMewFMskYx/rtzCnrdc4M7AI4xjjFpemyi/AWi/slov0NmfhVQGLb7U36sO95t0It8PKu6UTmHS1ciflaNHzoiiBd3GYHZp6eiWA2jWvSKtT2mrB0n24UhfzGvqMMU9SyiScgNMyFcxFneRP7ma9SSj6UA+efPukwhoypUxQuGSbibhph61YxwHbuUoobEVSCQhDAWIVdB+mIabSnKjd3wH3dWMa2P8CaOaQsKPREspmiAy+sukCCyEgLgBYCC9Co2dQuTpzdknc/RdC83BoN0fvVVX7kot3CDY2RrDhTwqru80UoDH+/wGUzYMiv+ckDmtfjEQMx8u8I4ZOoH/16NFiBvckcyqQY6Z3UM9nPJUoCZQEtjY6RhpnrVQGnHUihbhyegqEa8qJbOn6xF5jjbNUx/gvF7yT/twg3D6axA0uabnuVwKLVTNx7lx2NvI+F2/cFJYAlTq3hzWrchbHlu53+LJqX6fT26fJwIB9OzKI="

before_install:
  # Setup some env variables
  - GO_FILES=$(find . -iname '*.go' )  # All the .go files
  - PKGS=$(go list ./... )             # All the import paths

  # Setup dependency management tool
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh

  # Install linters
  - go get -u golang.org/x/lint/golint              # Linter
  - go get -u github.com/kisielk/errcheck           # errcheck checks that you checked errors.

install:
  - dep ensure

script:
  - go vet -v $PKGS                   # go vet is the official Go static analyzer
  - errcheck -verbose $PKGS           # Check for unchecked errors
  - golint -set_exit_status $PKGS     # One last linter

# calls goreleaser
before_deploy:
  - git checkout Gopkg.lock
deploy:
  - provider: script
    skip_cleanup: true
    script: curl -sL https://git.io/goreleaser | bash
    on:
      tags: true
      condition: $TRAVIS_OS_NAME = linux
